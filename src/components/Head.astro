---
// import CSS styles
import '@styles/wow.css'
import '@styles/cadeio.css'

import { SITE_CANON, SITE_TITLE } from '@common'
import type { ImageMetadata } from 'astro'

type Props = {
    title: string
    blurb: string
    image: ImageMetadata | string | undefined
}

// generate canonical URL for this page
// TODO: allow generation? or force them to be passed in?
const canon = new URL(Astro.url.pathname, Astro.site)

const { title, blurb, image } = Astro.props

// add in the site's title to the page's title
const title_full = `${title} | cade.io`
// const title_full = `${title} | ${SITE_TITLE}`

const image_url = image && image.src ? new URL(image.src, Astro.site) : new URL(image as string, Astro.site)
// const image_url = ((image && image.hasOwnProperty('src')) && new URL(image.src, Astro.site) || new URL(image, Astro.site)) || new URL('/favicon-96x96.png', Astro.site)
// const image_url = new URL(image.src, Astro.site)
---

<script is:inline>
    // NOTE: see Themes.astro for the actual theme switcher
    const theme_init = localStorage.getItem('theme') || 'blackboard'

    // now, set the attribute of the root document element to the theme
    document.documentElement.setAttribute('data-theme', theme_init)
</script>

<!-- Site Metadata -->
<meta charset='utf-8' />
<!-- <meta name="viewport" content="width=device-width,initial-scale=1" /> -->
<meta name='viewport' content='width=device-width, minimum-scale=1' />
<meta name='generator' content={Astro.generator} />
<link rel='sitemap' href='/sitemap-index.xml' />
<link rel='alternate' type='application/rss+xml' title={SITE_TITLE} href={new URL('rss.xml', Astro.site)} />

<!-- Site Favicon (autogenerated) -->
<link rel='icon' type='image/png' href='/favicon-96x96.png' sizes='96x96' />
<link rel='icon' type='image/svg+xml' href='/favicon.svg' />
<link rel='shortcut icon' href='/favicon.ico' />
<link rel='apple-touch-icon' sizes='180x180' href='/apple-touch-icon.png' />
<meta name='apple-mobile-web-app-title' content='cade.io' />
<link rel='manifest' href='/site.webmanifest' />

<!-- Page Metadata -->
<title>{title_full}</title>
<meta name='title' content={title_full} />
<meta name='description' content={blurb} />
<link rel='canonical' href={canon} />

<!-- Page Metadata: Open Graph / Facebook-->
<meta property='og:type' content='website' />
<meta property='og:url' content={Astro.url} />
<meta property='og:title' content={title_full} />
<meta property='og:description' content={blurb} />
<meta property='og:image' content={image_url} />

<!-- Page Metadata: Twitter -->
<meta property='twitter:card' content='summary_large_image' />
<meta property='twitter:url' content={Astro.url} />
<meta property='twitter:title' content={title_full} />
<meta property='twitter:description' content={blurb} />
<meta property='twitter:image' content={image_url} />

<!-- KaTex: Math Rendering -->
<!-- TODO: import this? bundle with the page? -->
<link rel='stylesheet' href='/ext/katex/katex.min.css' />

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<!-- TODO: is this even required? I don't think so -->
<!-- <script defer src="/ext/katex/katex.min.js" crossorigin="anonymous"></script> -->

<!-- KaTeX Extension: copy-tex, which allows clipboard to copy useful LaTeX source -->
<script defer src='/ext/katex/contrib/copy-tex.min.js' crossorigin='anonymous'></script>

<!-- TODO: some pages may need auto render... -->
<!-- <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script> -->

<!-- Font Family: Ubuntu -->
<link rel='preload' href='/fonts/Ubuntu-Regular.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-Italic.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-Bold.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-BoldItalic.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-Medium.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-MediumItalic.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-Light.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/Ubuntu-LightItalic.woff2' as='font' type='font/woff2' crossorigin />

<!-- Font Family: Ubuntu Mono -->
<link rel='preload' href='/fonts/UbuntuMono-Regular.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/UbuntuMono-Italic.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/UbuntuMono-Bold.woff2' as='font' type='font/woff2' crossorigin />
<link rel='preload' href='/fonts/UbuntuMono-BoldItalic.woff2' as='font' type='font/woff2' crossorigin />

<link rel='preconnect' href='https://fonts.googleapis.com' />
<link rel='preconnect' href='https://fonts.gstatic.com' crossorigin />
<link href='https://fonts.googleapis.com/css2?family=Doto:wght@100..900&display=swap' rel='stylesheet' />
